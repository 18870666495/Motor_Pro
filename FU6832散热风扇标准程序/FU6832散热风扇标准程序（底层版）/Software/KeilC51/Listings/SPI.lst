C51 COMPILER V9.53.0.0   SPI                                                               04/09/2024 13:54:57 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE SPI
OBJECT MODULE PLACED IN .\Objects\SPI.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\User\source\Hardware\SPI.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR
                    -(..\FU68xx_Hardware_Driver\Include;..\User\include) DEBUG PRINT(.\Listings\SPI.lst) TABS(2) OBJECT(.\Objects\SPI.obj)

line level    source

   1          /* --------------------------- (C) COPYRIGHT 2020 Fortiortech ShenZhen -----------------------------
   2              File Name      : SPI.c
   3              Author         : Fortiortech  Appliction Team
   4              Version        : V1.0
   5              Date           : 2020-04-11
   6              Description    : This file contains .C file function used for Motor Control.
   7          ----------------------------------------------------------------------------------------------------  
   8                                                 All Rights Reserved
   9          ------------------------------------------------------------------------------------------------- */
  10          #include "FU68xx_4.h"
  11          #include "MyProject.h"
  12          
  13          /*****************************************************************************
  14           * Function      : SPI_Init
  15           * Description   : SPI初始化
  16           * Input         : void  
  17           * Output        : None
  18           * Return        : 
  19           * Others        : 
  20           * Record
  21           * 1.Date        : 20190402
  22           *   Author      : Bruce HW&RD
  23           *   Modification: Created function
  24          
  25          *****************************************************************************/
  26          void SPI_Init(void)
  27          {
  28   1        ClrBit(SPI_CR1 , SPIEN);// 0,disable SPI;1 enable
  29   1      
  30   1      /*-------------------------------------------------------------------------------------------------
  31   1        SPI管脚配置
  32   1        1、禁止UART复用，P06配置为MISO，P05配置为MOSI
  33   1        2、禁止比较器输出复用，P07配置为SCLK
  34   1      -------------------------------------------------------------------------------------------------*/
  35   1      //    ClrBit(PH_SEL , UART1EN);// 0,P06 as GPIO or SPI_MISO,P05 as GPIO or SPI_MOSI;1,P06 and p07 as USART
  36   1      //    ClrBit(PH_SEL1 , SPICT); // 0:P05/P06 1:P00/P01
  37   1      /*-------------------------------------------------------------------------------------------------
  38   1        SPI时钟相位/极性配置
  39   1        CPHA = 0, CPOL = 0:上升沿接收，下降沿发送，空闲电平为低
  40   1        CPHA = 0, CPOL = 1:上升沿发送，下降沿接收，空闲电平为高
  41   1        CPHA = 1, CPOL = 0:上升沿发送，下降沿接收，空闲电平为低
  42   1        CPHA = 1, CPOL = 1:上升沿接收，下降沿发送，空闲电平为高
  43   1      -------------------------------------------------------------------------------------------------*/
  44   1        SetReg(SPI_CR0 , CPHA | CPOL , CPOL);
  45   1      /*-------------------------------------------------------------------------------------------------
  46   1        SPI从方式选择配置
  47   1        00：3线从方式或3线主方式，NSS信号不连到端口管脚
  48   1        01：4线从方式或4线多主方式，NSS配置为输入
  49   1        1x：4线单主方式，NSS配置为输出，NSS信号输出x电平
  50   1      -------------------------------------------------------------------------------------------------*/
  51   1      //  SetReg(SPI_CR1 , NSSMOD0 | NSSMOD1 , NSSMOD0 | NSSMOD1);    //三线DBG模式
  52   1          SetReg(SPI_CR1 , NSSMOD0 | NSSMOD1 , 0x00); //双线DBG模式
  53   1          SetBit(SPI_CR0 , SPIMS);                    // 0:Slave, 1:Master
  54   1      
C51 COMPILER V9.53.0.0   SPI                                                               04/09/2024 13:54:57 PAGE 2   

  55   1      /*-------------------------------------------------------------------------------------------------
  56   1        SPI中断配置
  57   1        SPIF：SPI字节传输完成中断标志，硬件置位，软件清零
  58   1        WCOL：SPI写冲突中断（发送缓冲器非空时写操作），硬件置位，软件清零
  59   1        MODF：SPI方式错误中断（多主方式NSS被拉低，MSTEN和SPIEN被清零）硬件置位，软件
             -零
  60   1        RXOVRN：SPI接收溢出中断（SPI接收缓冲器接收溢出），硬件置位，软件清零
  61   1      -------------------------------------------------------------------------------------------------*/
  62   1          SetReg(SPI_CR1 , SPIIF|WCOL|MODF|RXOVRN , 0x00);// SPI所有中断清除
  63   1          SPIIE = 0;                                  // SPI中断使能
  64   1          SPI_CLK = 0;    // Fspi = Fcpu / (2*(SPI_CLK + 1)) = 6MHz
  65   1          SetBit(SPI_CR1 , SPIEN);          // Enable SPI
  66   1      }
  67          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     46    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
