C51 COMPILER V9.53.0.0   TIMER                                                             04/09/2024 13:54:57 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Objects\TIMER.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\User\source\Hardware\TIMER.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCD
                    -IR(..\FU68xx_Hardware_Driver\Include;..\User\include) DEBUG PRINT(.\Listings\TIMER.lst) TABS(2) OBJECT(.\Objects\TIMER.o
                    -bj)

line level    source

   1          /**
   2            ******************************************************************************
   3            * @file           : TIMER.c
   4            * @copyright      : (c) 2022, Fortior Tech
   5            * @brief          : 
   6            * @date           : 2023-03-06
   7            * @version        : 1.0.1
   8            *
   9            ******************************************************************************
  10            * @attention
  11            *
  12            * This software is licensed under terms that can be found in the LICENSE file
  13            * in the root directory of this software component.
  14            * If no LICENSE file comes with this software, it is provided AS-IS.
  15            *
  16            ******************************************************************************
  17            */  
  18          
  19          /* Includes ------------------------------------------------------------------*/
  20          #include <FU68xx_4.h>
  21          
  22          
  23          /* Private includes ----------------------------------------------------------*/
  24          #include "MyProject.h"
  25          
  26          /* Private typedef -----------------------------------------------------------*/
  27          
  28          /* Private define ------------------------------------------------------------*/
  29          #define PWM_DefPin                       (TIM3_CHANNEL_1)                     /*!< PWM æ•ç²ä¾†æº ( @ref
             - speedCtrl_Mode ç‚º PWM_Mode æ™‚æœ‰æ•ˆ)  @see TIM3_CHANNEL_1 é€šé“0 @see TIM3_CHANNEL_1 é€šé“1*/
  30          
  31          
  32          
  33          /* Private macro -------------------------------------------------------------*/
  34          
  35          /* Private variables ---------------------------------------------------------*/
  36          
  37          /* Private function prototypes -----------------------------------------------*/
  38          
  39          /* Private user code ---------------------------------------------------------*/
  40          /**
  41            * @brief  TIM1 åˆå§‹åŒ–å‡½æ•¸
  42            * @bug    ç”±æ–¼è©²å‡½æ•¸é‚„æœªå®Œæˆï¼Œå¦‚æžœèª¿ç”¨å°‡ä¸æœƒæœ‰ä»»ä½•åŠŸèƒ½ä¸Šçš„è®ŠåŒ–
  43            * @retval ç„¡
  44            */
  45          void TIM1_Initial(void)
  46          {
  47   1        // do something.
  48   1      }
  49          
  50          
  51          /**
  52            * @brief    TIM2 åˆå§‹åŒ–å‡½æ•¸
C51 COMPILER V9.53.0.0   TIMER                                                             04/09/2024 13:54:57 PAGE 2   

  53            * @bug      ç”±æ–¼è©²å‡½æ•¸é‚„æœªå®Œæˆï¼Œå¦‚æžœèª¿ç”¨å°‡ä¸æœƒæœ‰ä»»ä½•åŠŸèƒ½ä¸Šçš„è®ŠåŒ–
  54            * @retval   ç„¡
  55            */
  56          void TIM2_Initial(void)
  57          {
  58   1        // do something.
  59   1      }
  60          
  61          
  62          /**
  63            * @brief  TIM3 åˆå§‹åŒ–å‡½æ•¸
  64            * @note   TIM3 è¢«ä½œç‚º PWM ä¿¡è™Ÿæ•ç²å°ˆç”¨è¨ˆæ•¸å™¨ï¼Œä¸å¯åœ¨ PWM ä¿¡è™Ÿæ•ç²ä»¥å¤–çš„æ‡‰ç”¨ä¸­ä
             -½¿ç”¨ã€‚
  65            * @retval ç„¡
  66            */
  67          void TIM3_Initial(void)
  68          {
  69   1        SetReg(TIM3_CR0, (T3PSC2 | T3PSC1 | T3PSC0), TIM3_CLOCKMULTIPLICATION_MUL2);
  70   1        SetReg(TIM3_CR0, (T3OPM),                    TIM_AUTORELOAD_ENABLE);
  71   1        SetReg(TIM3_CR0, (T3OCM),                    TIM_INPUT_RISING);
  72   1        SetReg(TIM3_CR0, (T3MOD),                    TIM_BASE_Mode);
  73   1        SetReg(TIM3_CR1, (T3IPE | T3IFE),            TIM_TS_TI1F1P);
  74   1        SetReg(TIM3_CR1, (T3NM1 | T3NM0),            TIM_TriggerFilter_NONE);
  75   1        SetReg(PH_SEL1,  (T3CT),                     PWM_DefPin);
  76   1        
  77   1        TIM3__ARR = 0;
  78   1        TIM3__DR  = 0;
  79   1        
  80   1        SetReg(IP2, (PTIM31 | PTIM30), TIM3_IP_10); 
  81   1        
  82   1        SetBit(TIM3_CR1, T3EN);                                   // è‡´èƒ½ TIM3 åŠŸèƒ½
  83   1        SetBit(PH_SEL, T3SEL);                                    // å•Ÿå‹• TIM3
  84   1      }
  85          
  86          
  87          /**
  88            * @brief    system tick åˆå§‹åŒ–å‡½æ•¸
  89            * @retval   ç„¡
  90            */
  91          void sysTick_Initial(void)
  92          {
  93   1        SetReg(IP2, (PSYSTICK1 | PSYSTICK0), SYSTICK_IP_01);      // è¨­å®š SYSTick ä¸­æ–·å„ªå…ˆæ¬Šç‚º 1
  94   1        SetReg(DRV_SR, SYSTIE, SYSTICK_TS_IF1F);
  95   1      }
  96          
  97          
  98          /**
  99            * @brief    TIM4 åˆå§‹åŒ–å‡½æ•¸
 100            * @note     TIM4 è¢«ä½œç‚º FG ä¿¡è™Ÿè¼¸å‡ºå°ˆç”¨è¨ˆæ•¸å™¨ï¼Œç•¶åœ¨å…¶ä»–æ‡‰ç”¨ä¸­ä½¿ç”¨ï¼Œ
 101                        å¿…é ˆä»¥ä¸å½±éŸ¿ FG è¼¸å‡ºç‚ºé¦–è¦æ¢ä»¶é€²è¡Œé–‹ç™¼ã€‚
 102            * @retval   ç„¡
 103            */
 104          void TIM4_Initial(void)
 105          {
 106   1        ClrBit(PH_SEL, T4SEL);                                     // åœæ­¢ TIM4
 107   1        ClrBit(TIM4_CR0, T4IRE);
 108   1        
 109   1        SetReg(TIM4_CR0, (T4PSC2 | T4PSC1 | T4PSC0), FG_ClockBase);
 110   1        SetReg(TIM4_CR0, (T4OPM),                    TIM_AUTORELOAD_ENABLE);
 111   1        SetReg(TIM4_CR0, (T4OCM),                    TIM_OCNPOLARITY_LOW);
 112   1        SetReg(TIM4_CR0, (T4MOD),                    TIM_PWM_Mode);
 113   1        SetReg(TIM4_CR1, (T4IPE  | T4IFE),           TIM_TS_TI1F);
C51 COMPILER V9.53.0.0   TIMER                                                             04/09/2024 13:54:57 PAGE 3   

 114   1        SetReg(TIM4_CR0, (T4IRE),                    TIS_TS_NOIR);
 115   1        SetReg(TIM4_CR1, (T4NM1 | T4NM0),            TIM_TriggerFilter_NONE);
 116   1        SetReg(PH_SEL1,  (T4CT),                     TIM4_CHANNEL_1);
 117   1        
 118   1        TIM4__ARR = 468;
 119   1        TIM4__DR  = 540;
 120   1        FOC_KFG = 0;
 121   1        
 122   1        SetReg(IP2, (PTIM41 | PTIM40), TIM4_IP_11);
 123   1      
 124   1        //SetBit(PH_SEL, T4SEL); 
 125   1        SetBit(TIM4_CR1, T4EN);                                   // è‡´èƒ½ TIM4 åŠŸèƒ½
 126   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    205    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
